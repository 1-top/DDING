{% extends 'base.html' %}
{% load static %}

{% block link %}
    {% static 'css/dding.css' %}
{% endblock %}

{% block content %}
    <div id="map"></div>
    <div class="search-box">
        <div class="show-address">
            <p class="address"></p>
        </div>
        <form action="#" id="search-form">
            <input type="text" name="address" placeholder="어디에서 찾으세요?"/>
        </form>
    </div>
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ key }}&libraries=services,clusterer,drawing"></script>
    <script>
        const mapContainer = document.getElementById('map');
        const mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667),
            level: 4
        };
        // 지도 생성
        const map = new kakao.maps.Map(mapContainer, mapOption);

        // 주소-좌표 변환 객체 생성
        const geocoder = new kakao.maps.services.Geocoder();

        window.addEventListener('load', () => {
            kakao.maps.load(() => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const {coords: {longitude: lng, latitude: lat}} = position
                        geocoder.coord2RegionCode(lng, lat, (result, status) => {
                            if (status === kakao.maps.services.Status.OK) {
                                pAddress = document.querySelector('.address')
                                pAddress.innerHTML = result[0].address_name;
                                console.log(result[0].address_name)
                            }
                        });
                        map.setCenter(new kakao.maps.LatLng(lat, lng))
                    });
                }
            })
        })

        // 위치 검색 후 이동

        const changeMapCenter = (address) => {
            geocoder.addressSearch(address, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    map.setCenter(coords);
                }
            });
        }

        const moveLocation = (e) => {
            e.preventDefault();
            let address = e.target.elements.address.value;
            changeMapCenter(address);
        }

        const searchForm = document.querySelector('#search-form');
        searchForm.addEventListener('submit', moveLocation);

    </script>
{% endblock %}

